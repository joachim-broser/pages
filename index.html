<table>
    <thead>
    </thead>
    <tbody>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/cv2_pickleable"
                               target="_blank"
                               title="cv2_pickleable">cv2_pickleable
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/docs"
                               target="_blank"
                               title="docs">docs
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/example_01_stitching_daylight_images"
                               target="_blank"
                               title="example_01_stitching_daylight_images">example_01_stitching_daylight_images
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/example_02_colorized_seams_and_edges"
                               target="_blank"
                               title="example_02_colorized_seams_and_edges">example_02_colorized_seams_and_edges
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/example_03_waviness_correction"
                               target="_blank"
                               title="example_03_waviness_correction">example_03_waviness_correction
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/example_04_demonstrate_all_projections"
                               target="_blank"
                               title="example_04_demonstrate_all_projections">example_04_demonstrate_all_projections
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/example_05_demonstrate_rotation"
                               target="_blank"
                               title="example_05_demonstrate_rotation">example_05_demonstrate_rotation
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/example_06_star_polygon_matcher_outperforms_orb_matcher_on_dawn_images"
                               target="_blank"
                               title="example_06_star_polygon_matcher_outperforms_orb_matcher_on_dawn_images">example_06_star_polygon_matcher_outperforms_orb_matcher_on_dawn_images
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/img_autumn_forest_a_8%2B8%2B4%2B1_shots"
                               target="_blank"
                               title="img_autumn_forest_a_8+8+4+1_shots">img_autumn_forest_a_8+8+4+1_shots
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/img_eisenberg_18h06m_ISO1600_10s"
                               target="_blank"
                               title="img_eisenberg_18h06m_ISO1600_10s">img_eisenberg_18h06m_ISO1600_10s
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/img_eisenberg_18h37m_ISO1600_30s"
                               target="_blank"
                               title="img_eisenberg_18h37m_ISO1600_30s">img_eisenberg_18h37m_ISO1600_30s
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/img_heidelstein"
                               target="_blank"
                               title="img_heidelstein">img_heidelstein
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
                            <img src="./folder_blue.png" style="max-width: 24px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/tree/master/img_windbuehl_2022-12-16_19h03m"
                               target="_blank"
                               title="img_windbuehl_2022-12-16_19h03m">img_windbuehl_2022-12-16_19h03m
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/.gitignore"
                               target="_blank"
                               title=".gitignore">.gitignore
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/README.md"
                               target="_blank"
                               title="README.md">README.md
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/custom_bf_polygon_matcher.py"
                               target="_blank"
                               title="custom_bf_polygon_matcher.py">custom_bf_polygon_matcher.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/custom_bruteforce_matcher.py"
                               target="_blank"
                               title="custom_bruteforce_matcher.py">custom_bruteforce_matcher.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>


<span>



<div>
<img src="./filenew.png" style="max-width: 20px;">

<a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/example_01a_stitching_daylight_images_with_ORB_cv.detail_BestOf2NearestMatcher.py"
   target="_blank"
   title="example_01a_stitching_daylight_images_with_ORB_cv.detail_BestOf2NearestMatcher.py">example_01a_stitching_daylight_images_with_ORB_cv.detail_BestOf2NearestMatcher.py
</a>

</div>



</span>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/example_01b_stitching_daylight_images_with_ORB_CustomBruteForceMatcher.py"
                               target="_blank"
                               title="example_01b_stitching_daylight_images_with_ORB_CustomBruteForceMatcher.py">example_01b_stitching_daylight_images_with_ORB_CustomBruteForceMatcher.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/example_02_colorize_seams_and_edges.py"
                               target="_blank"
                               title="example_02_colorize_seams_and_edges.py">example_02_colorize_seams_and_edges.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/example_03_waviness_correction.py"
                               target="_blank"
                               title="example_03_waviness_correction.py">example_03_waviness_correction.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/example_04_demonstrate_all_projections.py"
                               target="_blank"
                               title="example_04_demonstrate_all_projections.py">example_04_demonstrate_all_projections.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/example_05_demonstrate_rotation.py"
                               target="_blank"
                               title="example_05_demonstrate_rotation.py">example_05_demonstrate_rotation.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/example_06_star_polygon_matcher_outperforms_orb_matcher_on_dawn_images.py"
                               target="_blank"
                               title="example_06_star_polygon_matcher_outperforms_orb_matcher_on_dawn_images.py">example_06_star_polygon_matcher_outperforms_orb_matcher_on_dawn_images.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/fix_descartes_library.py"
                               target="_blank"
                               title="fix_descartes_library.py">fix_descartes_library.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/image_processors.py"
                               target="_blank"
                               title="image_processors.py">image_processors.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/requirements.txt"
                               target="_blank"
                               title="requirements.txt">requirements.txt
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <div>
                <div>

                        <div>
<img src="./filenew.png" style="max-width: 20px;">

                            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/stitching_detailed_enhanced.py"
                               target="_blank"
                               title="stitching_detailed_enhanced.py">stitching_detailed_enhanced.py
                            </a>
                        </div>

                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

<article>

    <div>
        <h1>OpenCV Starry Sky Panorama Stitcher
        </h1>

    </div>

    <div>
        <h2>Motivation
        </h2>

    </div>

    <ul>

        <li>PTGui (<a href="https://ptgui.com/" target="_blank">https://ptgui.com/</a>) does an excellent stitching job
            but it does not recognize stars as features. On each combination of 2 starry sky image, at least 3 features
            on each have to be labeled
            <strong>manually
            </strong>. Taking 21 images of the night sky yields at least 36 overlaps between images. For each overlap at
            least 3 stars have to be labeled manually on both images of the overlap. Pretty annoying.

            <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/pt_gui_manual_keypoint_labeling.png"
               target="_blank">
                <img alt=""
                     src="./docs/pt_gui_manual_keypoint_labeling.png"
                     style="max-width: 100%;"> </a>
        </li>

        <li>
            <a href="https://github.com/opencv/opencv/blob/4.x/samples/python/stitching_detailed.py" target="_blank">https://github.com/opencv/opencv/blob/4.x/samples/python/stitching_detailed.py </a>
            is a great example but not very self-explanatory for someone who hasn't stitched panoramas with OpenCV
            before. The stitching pipeline presented in
            <code>stitching_detail.py
            </code> (comprising feature detection, pairwise image matching, homography estimation, bundle adjustment,
            waviness correction, image warping, stitching seam estimation and seaming/masking, timelapsing of warped
            images, blending of warped images) does not provide deep insights into what OpenCV is doing under the hood
            and what is the result/output of each step.

            <strong>Remedy is provided here:
            </strong> The stitching pipeline presented here is an enhanced version of

            <code>stitching_detaily.py
            </code> and offers more documentation within the code and a better understanding of each step within the
            stitching pipeline due to a lot of image output to disk.

        </li>

        <li>The matchers used in <code>stitching_detaily.py </code> ( <code>cv.detail_BestOf2NearestMatcher </code> and
            <code>cv.detail_BestOf2NearestRangeMatcher </code>) perform poorly on starry sky images. <strong>Therefore a
                custom bruteforce matcher </strong> (leveraging <code>cv.BFMatcher(cv.NORM_HAMMING)</code>) <strong> is
                introduced here </strong> which returns a tuple of <code>cv2.detail.MatchesInfo </code> objects like
            <code>cv.detail_BestOf2NearestMatcher </code> and <code>cv.detail_BestOf2NearestRangeMatcher </code> also
            do.

        </li>

    </ul>

    <div>
        <h2>Collecting images for a fisheye panorama
        </h2>

    </div>

    <p>For an all sky fisheye panorama starry sky images should be taken according to a plan.
    </p>

    <p>For an 18 mm lens this setup yields good overlap between the images:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/image_plan_for_all_sky_circular_fisheye.png"
           target="_blank">
            <img alt=""
                 src="./docs/image_plan_for_all_sky_circular_fisheye.png"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h2>ORB keypoint/descriptor matching vs. shape/constellation matching
        </h2>

    </div>

    <p>OpenCV matchers can match keypoints/descriptors, which are single points on each image:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/Oystercatcher_01_full.png"
           target="_blank">
            <img alt=""
                 src="./docs/Oystercatcher_01_full.png"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/Oystercatcher_02_keypoints.png"
           target="_blank">
            <img alt=""
                 src="./docs/Oystercatcher_02_keypoints.png"
                 style="max-width: 100%;"> </a>
    </p>

    <p>On starry sky images, especially on images with a low amount of stars and a dark unique background,
        this can become problematic because »many stars look the same«.
    </p>

    <p>Matching star constellations would be helfpful but OpenCV matchers are not able to match constellations – they
        are just able to match keypoints/descriptors.
    </p>

    <p>The
        <strong>StarPolygonMatcher
        </strong> presented here provides this functionality:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/polygon_shape_matching.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/polygon_shape_matching.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Star constellations or polygons are compared based on angles, side lengths and star brightnesses.
    </p>

    <p>For a 5-sided polygon like shown above there are 5 vertex angles, 5 side lengths and 5 star brightnesses.
    </p>

    <p>The
        <strong>vertex angles and side lengths
        </strong> are
        <strong>not measured in the image plane
        </strong>! The stars from the image plane are projected to a sphere in the physical real world. Angles and side
        lengths are then measured on this sphere leveraging spherical trigonometry. The radius of this sphere does not
        matter since
        <strong>side lengths of spherical triangles
        </strong> are measured in
        <strong>radian
        </strong>.

    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/projecting_stars_from_the_image_plane_onto_a_sphere.png"
           target="_blank">
            <img alt=""
                 src="./docs/projecting_stars_from_the_image_plane_onto_a_sphere.png"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h2>The panorama stitching pipeline
        </h2>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/pipeline.png"
           target="_blank">
            <img alt=""
                 src="./docs/pipeline.png"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h2>Examples
        </h2>

    </div>

    <div>
        <h3>Example 1: Stitching daylight images
        </h3>

    </div>

    <p>
        <code>cv.detail_BestOf2NearestMatcher
        </code> (left) and
        <code>CustomBruteForceMatcher
        </code> (right) yield comparable results on daylight images.
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_01/cv.detail_BestOf2NearestMatcher_vs_CustomBruteForceMatcher.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_01/cv.detail_BestOf2NearestMatcher_vs_CustomBruteForceMatcher.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h3>Example 2: Colorizing seams and edges
        </h3>

    </div>

    <div>
        <h4>Keypoints detected by ORB
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/z_ORB_keypoints.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/z_ORB_keypoints.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Stars detected by Canny Edge
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/z_CannyEdge.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/z_CannyEdge.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>ORB features generated from stars detected by Canny Edge
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/z_StarFeatures.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/z_StarFeatures.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Matches (inliers) found via ORB keypoing matching
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/ORB___omitted_____conf=0.22444___num_inliers=9___02-horiz-ne.jpg___10-alt1-ne.jpg.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/ORB___omitted_____conf=0.22444___num_inliers=9___02-horiz-ne.jpg___10-alt1-ne.jpg.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Reducing the amount of stars by
            <code>sklearn.cluster.AgglomerativeClustering
            </code>
        </h4>

    </div>

    <p>All keypoints created by Canny Edge star detection:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_23h31m35s__04_polygon_matches__02-horiz-ne.jpg___10-alt1-ne.jpg/00_all_star_keypoints_before_clustering_02-horiz-ne.jpg___10-alt1-ne.jpg__619kps___1000kps.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/2022-12-30_23h31m35s__04_polygon_matches__02-horiz-ne.jpg___10-alt1-ne.jpg/00_all_star_keypoints_before_clustering_02-horiz-ne.jpg___10-alt1-ne.jpg__619kps___1000kps.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Keypoints marked for deletion after a cluster size of 15 stars per image region was defined:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_23h31m35s__04_polygon_matches__02-horiz-ne.jpg___10-alt1-ne.jpg/01_all_star_keypoints_highlighted_if_removed_by_clustering_02-horiz-ne.jpg___10-alt1-ne.jpg__619kps___1000kps.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/2022-12-30_23h31m35s__04_polygon_matches__02-horiz-ne.jpg___10-alt1-ne.jpg/01_all_star_keypoints_highlighted_if_removed_by_clustering_02-horiz-ne.jpg___10-alt1-ne.jpg__619kps___1000kps.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>The remaining stars after clustering:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_23h31m35s__04_polygon_matches__02-horiz-ne.jpg___10-alt1-ne.jpg/02_remaining_keypoints_after_clustering__02-horiz-ne.jpg___10-alt1-ne.jpg__68kps___72kps.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/2022-12-30_23h31m35s__04_polygon_matches__02-horiz-ne.jpg___10-alt1-ne.jpg/02_remaining_keypoints_after_clustering__02-horiz-ne.jpg___10-alt1-ne.jpg__68kps___72kps.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Star amount was reduced by splitting the image in several regions and reducing the size of clusters per region
        simultaneously by
        <code>sklearn.cluster.AgglomerativeClustering
        </code>:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/cluster_star_reduction_steps.png"
           target="_blank">
            <img alt=""
                 src="./docs/cluster_star_reduction_steps.png"
                 style="max-width: 100%;"> </a>
    </p>

    <p>The 12 image regions used for star clustering are:
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/12_image_regions_for_clustering.png"
           target="_blank">
            <img alt=""
                 src="./docs/12_image_regions_for_clustering.png"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Matching polygons (star constellations) found by the Custom Star Polygon Matcher
        </h4>
    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_23h31m35s__04_polygon_matches__02-horiz-ne.jpg___10-alt1-ne.jpg/dist=0.0620__polygon-1708_and_polygon1134__spanned_by_kps(1098-1010-1016-1020-1197)_and(1108-1022-1036-1050-1169).jpg"
           target="_blank">
            <img alt=""
                 src="./docs/optimized_imgs_to_prevent_403_error/example_2_matching_polygons.jpg"
                 style="max-width: 100%;"> </a>
    </p>



    <div>
        <h4>Matches (inliers) found via StarPolygonMatching
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/STARS______conf=3.00000___num_inliers=8___02-horiz-ne.jpg___10-alt1-ne.jpg.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/STARS______conf=3.00000___num_inliers=8___02-horiz-ne.jpg___10-alt1-ne.jpg.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Warped images
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/timelapse_fixed_02-horiz-ne.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/timelapse_fixed_02-horiz-ne.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/timelapse_fixed_10-alt1-ne.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/timelapse_fixed_10-alt1-ne.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Seams
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/timelapse_redseam_fixed_02-horiz-ne.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/timelapse_redseam_fixed_02-horiz-ne.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/timelapse_redseam_fixed_10-alt1-ne.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/timelapse_redseam_fixed_10-alt1-ne.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Colorized edges
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/timelapse_colorized_edges_fixed_02-horiz-ne.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/timelapse_colorized_edges_fixed_02-horiz-ne.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/timelapse_colorized_edges_fixed_10-alt1-ne.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/timelapse_colorized_edges_fixed_10-alt1-ne.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h4>Assembled panorama
        </h4>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_13h31m14s__fisheye_no-000__red_seams.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/2022-12-30_13h31m14s__fisheye_no-000__red_seams.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_13h31m48s__fisheye_no-000__colored_edges.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/2022-12-30_13h31m48s__fisheye_no-000__colored_edges.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_13h32m13s__fisheye_multiband-001__colored_edges.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/2022-12-30_13h32m13s__fisheye_multiband-001__colored_edges.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_02_colorized_seams_and_edges/2022-12-30_12h33m24s__fisheye_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_02_colorized_seams_and_edges/2022-12-30_12h33m24s__fisheye_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h3>Example 3: Removing the waviness effect
        </h3>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_03_waviness/2022-12-30_12h33m29s_no-waviness-correction_cylindrical_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_03_waviness/2022-12-30_12h33m29s_no-waviness-correction_cylindrical_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_03_waviness/2022-12-30_19h50m51s_horizontal-waviness-correction_cylindrical_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_03_waviness/2022-12-30_19h50m51s_horizontal-waviness-correction_cylindrical_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h3>Example 4: Projections (warp modes)
        </h3>

    </div>

    <p>Plane
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m10s_warp_mode=plane_plane_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m10s_warp_mode=plane_plane_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Spherical
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m10s_warp_mode=spherical_spherical_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m10s_warp_mode=spherical_spherical_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Affine
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m11s_warp_mode=affine_affine_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m11s_warp_mode=affine_affine_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Cylindrical
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m12s_warp_mode=cylindrical_cylindrical_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m12s_warp_mode=cylindrical_cylindrical_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Fisheye
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m12s_warp_mode=fisheye_fisheye_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m12s_warp_mode=fisheye_fisheye_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Stereographic
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m13s_warp_mode=stereographic_stereographic_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m13s_warp_mode=stereographic_stereographic_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>CompressedPlaneA2B1
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m15s_warp_mode=compressedPlaneA2B1_compressedPlaneA2B1_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m15s_warp_mode=compressedPlaneA2B1_compressedPlaneA2B1_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>CompressedPlaneA1.5B1
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m16s_warp_mode=compressedPlaneA1.5B1_compressedPlaneA1.5B1_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m16s_warp_mode=compressedPlaneA1.5B1_compressedPlaneA1.5B1_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Paninia2B1
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m22s_warp_mode=paniniA2B1_paniniA2B1_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m22s_warp_mode=paniniA2B1_paniniA2B1_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Paninia1.5B1
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m23s_warp_mode=paniniA1.5B1_paniniA1.5B1_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m23s_warp_mode=paniniA1.5B1_paniniA1.5B1_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>Mercator
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m29s_warp_mode=mercator_mercator_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m29s_warp_mode=mercator_mercator_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>TransverseMercator
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_04_warp_modes/2022-12-30_19h58m30s_warp_mode=transverseMercator_transverseMercator_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_04_warp_modes/2022-12-30_19h58m30s_warp_mode=transverseMercator_transverseMercator_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <div>
        <h3>Example 5: Rotating cameras
        </h3>

    </div>

    <p>0°
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_05_rotation/2022-12-30_19h47m53s_rot=000deg_fisheye_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_05_rotation/2022-12-30_19h47m53s_rot=000deg_fisheye_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>90°
    </p>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_05_rotation/2022-12-30_19h48m12s_rot=090deg_fisheye_multiband-042.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/example_05_rotation/2022-12-30_19h48m12s_rot=090deg_fisheye_multiband-042.jpg"
                 style="max-width: 100%;"> </a>
    </p>

    <p>...
    </p>

    <div>
        <h3>Example 6: ORB matching results vs. CustomStarPolygon matching results
        </h3>

    </div>

    <p>
        <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/example_06_comparison_ORB_matching_vs_StarPolygon_matching/01-horiz-n.jpg__02-horiz-ne.jpg__ORB__omitted__conf=0.24145__num_inliers=12.jpg"
           target="_blank">
            <img alt=""
                 src="./docs/optimized_imgs_to_prevent_403_error/example_6_orb_vs_star_polygon.jpg"
                 style="max-width: 100%;"> </a>
<p>




    <div>
        <h2>Left to do
        </h2>

    </div>

    <ul>

        <li>

            <p>Consider
                <strong>image distortion
                </strong>. Take some
                <strong>chessboard
                </strong> images and remove image distortion. Does this yield better polygon matching results?
            </p>

        </li>

        <li>

            <p>Add multiprocessing for these (now consecutive) pipeline steps: Star regcognition, star amount reduction
                by sklearn.cluster.AgglomerativeClustering, polygon measuring
            </p>

        </li>

        <li>

            <p>Drop mistakenly detected stars at the horizon edge.
            </p>

            <p>
                <a href="https://github.com/joachim-broser/opencv-starry-sky-panorama-stitcher/blob/master/docs/left-to-do/stars_horizon.png"
                   target="_blank">
                    <img alt=""
                         src="./docs/left-to-do/stars_horizon.png"
                         style="max-width: 100%;"> </a>
            </p>

        </li>

    </ul>

    <p>December 2022
    </p>

    <p>Joachim Broser
    </p>

</article>
